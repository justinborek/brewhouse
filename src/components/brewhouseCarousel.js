import React, { Component } from 'react';
import { Carousel, Button, Modal } from 'react-bootstrap';
import { connect } from 'react-redux';
import '../styles/carousel.css';

import emptyCarboy from '../images/emptycarboy2.png';
import SRMtoRGB from '../assets/color-conversion';

class CarouselInstance extends Component {
  componentWillMount() {
    let carboyDataTwo = [];
    this.props.user.equipment.fermenters.map((carboy) => {
      if (carboy.activeRecipe) {
        carboyDataTwo.push(carboy);
      }
    });
    this.setState({ carboyData: carboyDataTwo})
  }
  constructor(...args) {
		super(...args);

		this.handleShow = this.handleShow.bind(this);
    this.handleClose = this.handleClose.bind(this);
    this.handleSelect = this.handleSelect.bind(this);
    
    this.state = { 
      showModal: false,
      index: 0, 
      direction: null,
      activeSlide: this.props.user.equipment.fermenters[0].activeRecipe
    };
	}

	handleClose() {
		this.setState({ showModal: false });
	}

	handleShow() {
		this.setState({ showModal: true });
  }

  handleSelect(selectedIndex, e) {
    this.setState({
      index: selectedIndex,
      direction: e.direction,
      activeSlide: this.state.carboyData[selectedIndex].activeRecipe
    })
  }

  createSVG(color) {  // generates the color overlay for the carboy image
    return (
      <svg xmlns="http://www.w3.org/2000/svg" className="carboyColor"
      width="4.375in" height="8.76389in"
      viewBox="0 0 315 631">
        <path id="Selection"
              fill={color} stroke="black" stroke-width="1"
              d="M 98.00,127.00
                  C 98.00,127.00 116.00,126.00 116.00,126.00
                    116.00,126.00 135.00,126.00 135.00,126.00
                    135.00,126.00 151.00,125.04 151.00,125.04
                    151.00,125.04 165.00,125.04 165.00,125.04
                    165.00,125.04 176.00,126.00 176.00,126.00
                    176.00,126.00 195.00,126.00 195.00,126.00
                    195.00,126.00 224.00,127.91 224.00,127.91
                    234.64,128.66 245.91,129.29 256.00,133.00
                    256.00,133.00 256.00,135.00 256.00,135.00
                    245.24,138.52 224.42,140.94 213.00,141.00
                    213.00,141.00 195.00,142.00 195.00,142.00
                    195.00,142.00 177.00,142.00 177.00,142.00
                    177.00,142.00 165.00,142.95 165.00,142.95
                    165.00,142.95 149.00,142.95 149.00,142.95
                    149.00,142.95 136.00,142.00 136.00,142.00
                    136.00,142.00 116.00,142.00 116.00,142.00
                    116.00,142.00 87.00,140.09 87.00,140.09
                    76.36,139.34 65.09,138.71 55.00,135.00
                    55.00,135.00 55.00,133.00 55.00,133.00
                    65.76,129.48 86.58,127.06 98.00,127.00 Z
                  M 170.00,135.00
                  C 170.00,135.00 171.00,136.00 171.00,136.00
                    171.00,136.00 171.00,135.00 171.00,135.00
                    171.00,135.00 170.00,135.00 170.00,135.00 Z
                  M 275.00,144.88
                  C 278.32,147.50 280.87,148.96 283.96,152.04
                    292.47,160.56 296.98,173.12 297.00,185.00
                    297.00,185.00 297.00,238.00 297.00,238.00
                    297.00,238.00 296.00,255.00 296.00,255.00
                    296.00,255.00 296.00,320.00 296.00,320.00
                    296.00,320.00 296.00,557.00 296.00,557.00
                    295.97,579.38 278.80,596.52 259.00,604.60
                    242.85,611.19 227.03,611.52 210.00,613.17
                    186.95,615.40 164.19,616.27 141.00,616.00
                    141.00,616.00 116.00,614.09 116.00,614.09
                    87.56,612.13 59.01,612.50 36.00,593.25
                    28.29,586.79 24.38,582.32 20.43,573.00
                    17.46,566.01 17.01,563.49 17.00,556.00
                    17.00,556.00 17.00,348.00 17.00,348.00
                    17.00,348.00 17.00,253.00 17.00,253.00
                    17.00,253.00 16.00,238.00 16.00,238.00
                    16.00,238.00 16.00,186.00 16.00,186.00
                    16.02,174.15 20.67,160.64 29.29,152.21
                    29.29,152.21 36.72,146.70 36.72,146.70
                    39.99,144.02 44.89,138.46 49.00,137.61
                    49.00,137.61 69.00,141.92 69.00,141.92
                    82.48,144.19 100.35,145.84 114.00,146.00
                    114.00,146.00 129.00,147.00 129.00,147.00
                    162.74,147.05 218.28,147.89 250.00,140.35
                    250.00,140.35 261.00,136.77 261.00,136.77
                    266.63,136.94 270.74,141.52 275.00,144.88 Z
                  M 263.00,143.00
                  C 263.00,143.00 264.00,144.00 264.00,144.00
                    264.00,144.00 264.00,143.00 264.00,143.00
                    264.00,143.00 263.00,143.00 263.00,143.00 Z
                  M 275.00,152.00
                  C 275.00,152.00 276.00,153.00 276.00,153.00
                    276.00,153.00 276.00,152.00 276.00,152.00
                    276.00,152.00 275.00,152.00 275.00,152.00 Z
                  M 31.00,158.00
                  C 31.00,158.00 32.00,159.00 32.00,159.00
                    32.00,159.00 32.00,158.00 32.00,158.00
                    32.00,158.00 31.00,158.00 31.00,158.00 Z
                  M 30.00,235.00
                  C 30.00,235.00 31.00,236.00 31.00,236.00
                    31.00,236.00 31.00,235.00 31.00,235.00
                    31.00,235.00 30.00,235.00 30.00,235.00 Z
                  M 213.00,253.00
                  C 213.00,253.00 214.00,254.00 214.00,254.00
                    214.00,254.00 214.00,253.00 214.00,253.00
                    214.00,253.00 213.00,253.00 213.00,253.00 Z
                  M 180.00,281.00
                  C 180.00,281.00 181.00,282.00 181.00,282.00
                    181.00,282.00 181.00,281.00 181.00,281.00
                    181.00,281.00 180.00,281.00 180.00,281.00 Z
                  M 290.00,315.00
                  C 290.00,315.00 291.00,316.00 291.00,316.00
                    291.00,316.00 291.00,315.00 291.00,315.00
                    291.00,315.00 290.00,315.00 290.00,315.00 Z
                  M 248.00,443.00
                  C 248.00,443.00 249.00,444.00 249.00,444.00
                    249.00,444.00 249.00,443.00 249.00,443.00
                    249.00,443.00 248.00,443.00 248.00,443.00 Z" />
      </svg>
    )
  }

  createGradient() {  // generates the gradient overlay for the carboy image
    return (
      <svg className="carboyGradient" xmlns="http://www.w3.org/2000/svg"
     width="4.375in" height="8.76389in"
     viewBox="0 0 315 631">
        <defs> 
        <linearGradient id="Gradient2" x1="0">
          <stop offset="5%" stop-color = "black" stop-opacity=".6"/>
          <stop offset="15%" stop-color = "black" stop-opacity=".2"/>
          <stop offset="50%" stop-color="black" stop-opacity="0"/>
          <stop offset="85%" stop-color = "black" stop-opacity=".2"/>
          <stop offset="95%" stop-color = "black" stop-opacity=".6"/>
        </linearGradient> 
        </defs>
        <path id="Selection"
              fill="url(#Gradient2)" stroke="black" stroke-width="1"
              d="M 176.00,14.00
                C 176.00,14.00 173.48,26.00 173.48,26.00
                  173.40,29.30 174.76,31.40 174.98,34.00
                  174.98,34.00 174.02,43.00 174.02,43.00
                  173.86,47.88 174.35,49.47 174.84,54.00
                  177.17,75.81 184.76,89.47 203.00,102.57
                  225.35,118.62 252.40,126.78 274.00,144.07
                  274.00,144.07 283.96,152.04 283.96,152.04
                  292.47,160.56 296.98,173.12 297.00,185.00
                  297.00,185.00 297.00,238.00 297.00,238.00
                  297.00,238.00 296.00,255.00 296.00,255.00
                  296.00,255.00 296.00,557.00 296.00,557.00
                  295.96,584.56 270.69,602.95 246.00,608.87
                  234.26,611.69 221.96,612.01 210.00,613.17
                  210.00,613.17 186.00,615.00 186.00,615.00
                  186.00,615.00 170.00,616.00 170.00,616.00
                  170.00,616.00 143.00,616.00 143.00,616.00
                  143.00,616.00 131.00,615.09 131.00,615.09
                  131.00,615.09 104.00,613.17 104.00,613.17
                  91.66,611.99 79.14,611.62 67.00,608.76
                  42.00,602.88 17.04,583.67 17.00,556.00
                  17.00,556.00 17.00,348.00 17.00,348.00
                  17.00,348.00 17.00,253.00 17.00,253.00
                  17.00,253.00 16.00,238.00 16.00,238.00
                  16.00,238.00 16.00,186.00 16.00,186.00
                  16.02,174.24 20.33,161.83 28.44,153.10
                  31.51,149.79 34.25,148.84 37.58,145.96
                  37.58,145.96 46.00,138.78 46.00,138.78
                  46.00,138.78 109.72,103.29 109.72,103.29
                  119.18,96.89 131.30,82.86 135.27,72.09
                  137.59,65.79 139.04,51.83 139.00,45.00
                  139.00,45.00 138.06,35.00 138.06,35.00
                  138.19,31.60 140.12,29.74 139.66,25.00
                  139.66,25.00 137.00,14.00 137.00,14.00
                  137.00,14.00 176.00,14.00 176.00,14.00 Z
                M 180.00,88.00
                C 180.00,88.00 181.00,89.00 181.00,89.00
                  181.00,89.00 181.00,88.00 181.00,88.00
                  181.00,88.00 180.00,88.00 180.00,88.00 Z
                M 170.00,135.00
                C 170.00,135.00 171.00,136.00 171.00,136.00
                  171.00,136.00 171.00,135.00 171.00,135.00
                  171.00,135.00 170.00,135.00 170.00,135.00 Z
                M 263.00,143.00
                C 263.00,143.00 264.00,144.00 264.00,144.00
                  264.00,144.00 264.00,143.00 264.00,143.00
                  264.00,143.00 263.00,143.00 263.00,143.00 Z
                M 275.00,152.00
                C 275.00,152.00 276.00,153.00 276.00,153.00
                  276.00,153.00 276.00,152.00 276.00,152.00
                  276.00,152.00 275.00,152.00 275.00,152.00 Z
                M 31.00,158.00
                C 31.00,158.00 32.00,159.00 32.00,159.00
                  32.00,159.00 32.00,158.00 32.00,158.00
                  32.00,158.00 31.00,158.00 31.00,158.00 Z
                M 30.00,235.00
                C 30.00,235.00 31.00,236.00 31.00,236.00
                  31.00,236.00 31.00,235.00 31.00,235.00
                  31.00,235.00 30.00,235.00 30.00,235.00 Z
                M 213.00,253.00
                C 213.00,253.00 214.00,254.00 214.00,254.00
                  214.00,254.00 214.00,253.00 214.00,253.00
                  214.00,253.00 213.00,253.00 213.00,253.00 Z
                M 180.00,281.00
                C 180.00,281.00 181.00,282.00 181.00,282.00
                  181.00,282.00 181.00,281.00 181.00,281.00
                  181.00,281.00 180.00,281.00 180.00,281.00 Z
                M 290.00,315.00
                C 290.00,315.00 291.00,316.00 291.00,316.00
                  291.00,316.00 291.00,315.00 291.00,315.00
                  291.00,315.00 290.00,315.00 290.00,315.00 Z
                M 248.00,443.00
                C 248.00,443.00 249.00,444.00 249.00,444.00
                  249.00,444.00 249.00,443.00 249.00,443.00
                  249.00,443.00 248.00,443.00 248.00,443.00 Z" />
      </svg>
    )
  }

  render() {
    return (
      <Carousel 
        className = "carousel"
        activeIndex={this.state.index}
        direction={this.state.direction}
        onSelect={this.handleSelect}
      >
        { this.state.carboyData.map((currentCarboy) => {
          if (currentCarboy.activeRecipe) {
            const currentRecipeColor = SRMtoRGB[currentCarboy.activeRecipe.color];
            return (
              <Carousel.Item className = 'carouselItem'>
                <Modal show={this.state.showModal} onHide={this.handleClose}>
                  <Modal.Body>
                    <h4>{this.state.activeSlide.title}</h4>
                    <p>
                      {this.state.activeSlide.color}
                    </p>
                  </Modal.Body>
                  <Modal.Footer>
                    <Button onClick={this.handleClose}>Close</Button>
                  </Modal.Footer>
                </Modal>
                <div className="carboyItem">
                  { this.createGradient() }
                  { this.createSVG(currentRecipeColor) }
                  <img 
                    className="carboyImage"
                    src={ emptyCarboy } 
                    onMouseDown={this.handleShow}
                  />
                </div>
                <Carousel.Caption>
                  <div className = "caption">
                    <h3>{currentCarboy.activeRecipe.title}</h3>
                  </div>
                </Carousel.Caption>
              </Carousel.Item>
            )
          }
        })}
      </Carousel>
    );
  }
}


const mapStateToProps = (state) => {
  return {
    user: state.user,
  };
};

export default connect(mapStateToProps)(CarouselInstance);
